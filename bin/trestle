#! /usr/bin/env bash

trestle_tag="20240918"

command="bash"
if [ "$1" != "" ]; then
  command="$1"
  shift 1
fi

oscal_location="$(dirname "$(realpath "$0")")/../doc/compliance"

if [ ! -f "$oscal_location/trestle-config.yaml" ]; then
  echo "Compliance submodule is not cloned yet!"
  git submodule init
  git submodule update
fi

current_branch=`git rev-parse --abbrev-ref HEAD`
(cd "$oscal_location" && (git switch "$current_branch" 2>/dev/null || git switch -c "$current_branch"))

docker run -it --rm -v "$oscal_location:/app/docs:rw" ghcr.io/gsa-tts/trestle:$trestle_tag "$command" "$@"
